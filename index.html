<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcriptor con Editor</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Transcriptor de Voz</h1>
    
    <button id="grabarBtn">Iniciar Transcripción</button>
    <button id="copiarTexto">Copiar Texto</button>
    <span id="mensajeCopiado" style="display: none; color: green; font-weight: bold;">✔ Texto copiado</span>
    <button id="mostrarComandosBtn">Ver Comandos</button>
    
    <div id="editor-container">
        <div id="editor"></div>
    </div>
    
    <div id="comandosContainer" style="display: none;">
        <h2>Comandos Agregados</h2>
        <ul id="listaComandos"></ul>
    </div>
    
    <div id="agregarComandoContainer">
        <h2>Agregar Comandos de Voz</h2>
        <input type="text" id="comandoTexto" placeholder="Ejemplo: 'coma' , ','">
        <button id="agregarComandoBtn">Agregar Comando</button>
    </div>
    
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            placeholder: 'Escribe aquí o usa la transcripción...'
        });

        let recognition;
        let grabando = false;
        let comandos = { "coma": ",", "punto": "." };

        document.getElementById("grabarBtn").addEventListener("click", function() {
            grabando = !grabando;
            this.textContent = grabando ? "Detener Transcripción" : "Iniciar Transcripción";
            
            if (!recognition) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'es-ES';
                recognition.onresult = function(event) {
                    let texto = "";
                    for (let i = 0; i < event.results.length; i++) {
                        let transcript = event.results[i][0].transcript.toLowerCase();
                        for (let comando in comandos) {
                            transcript = transcript.replace(new RegExp(comando, "g"), comandos[comando]);
                        }
                        texto += transcript + " ";
                    }
                    quill.root.innerHTML = texto.trim();
                };
                recognition.onend = function() {
                    if (grabando) recognition.start();
                };
            }
            grabando ? recognition.start() : recognition.stop();
        });

        document.getElementById("copiarTexto").addEventListener("click", function() {
            let contenido = quill.root.innerText;
            navigator.clipboard.writeText(contenido).then(() => {
                let mensaje = document.getElementById("mensajeCopiado");
                mensaje.style.display = "inline";
                setTimeout(() => mensaje.style.display = "none", 2000);
            });
        });

        document.getElementById("agregarComandoBtn").addEventListener("click", function() {
            let input = document.getElementById("comandoTexto").value.split(',');
            if (input.length === 2) {
                let comando = input[0].trim().toLowerCase();
                let simbolo = input[1].trim();
                comandos[comando] = simbolo;
                actualizarListaComandos();
            } else {
                alert("Formato incorrecto. Usa: 'palabra', 'símbolo'");
            }
        });

        document.getElementById("mostrarComandosBtn").addEventListener("click", function() {
            let container = document.getElementById("comandosContainer");
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        });

        function actualizarListaComandos() {
            let lista = document.getElementById("listaComandos");
            lista.innerHTML = "";
            for (let comando in comandos) {
                let li = document.createElement("li");
                li.textContent = `${comando} → ${comandos[comando]}`;
                lista.appendChild(li);
            }
        }

        actualizarListaComandos();
    </script>
</body>
</html>
